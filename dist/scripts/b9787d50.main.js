function addCommas(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}function getToplineDate(a){var b=a.substring(0,2),c=a.substring(4,5),d=a.substring(6,8);c=monthNames[c-1];var e=b+" "+c+" 20"+d;return e}function wrap(a,b,c){a.each(function(){for(var a,d=d3.select(this),e=c.split(/\s+/).reverse(),f=[],g=0,h=1.3,i=d.attr("x"),j=d.attr("y"),k=0,l=d.text(null).append("tspan").attr("x",i).attr("y",j).attr("dy",k+"em");a=e.pop();)f.push(a),l.text(f.join(" ")),l.node().getComputedTextLength()>b&&(f.pop(),l.text(f.join(" ")),f=[a],l=d.append("tspan").attr("x",i).attr("y",j).attr("dy",++g*h+k+"em").text(a))})}var Vizlib=function(sources,callback){function loadFrame(a,b){activeFrame=a,d3.selectAll(".frame").transition().duration(b).style("opacity",0).style("display","none"),d3.selectAll(".frame"+a).transition().duration(b).style("opacity",1).style("display","block"),1==activeFrame?$("#framePrev").prop("disabled",!0):$("#framePrev").prop("disabled",!1),activeFrame==maxFrames?($("#frameNext").prop("disabled",!0),$("#rightButton").hide()):$("#frameNext").prop("disabled",!1)}function initFrame(){loadFrame(activeFrame,0)}function frameHandler(a,b){var c={};return c.frame=!0,$.isArray(a)?a.forEach(function(a){c["frame"+a]=!0}):c["frame"+a]=!0,b.classed(c),b}function addCommas(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}function wrap(a,b,c){a.each(function(){for(var a,d=d3.select(this),e=c.split(/\s+/).reverse(),f=[],g=0,h=1.3,i=d.attr("x"),j=d.attr("y"),k=0,l=d.text(null).append("tspan").attr("x",i).attr("y",j).attr("dy",k+"em");a=e.pop();)f.push(a),l.text(f.join(" ")),l.node().getComputedTextLength()>b&&(f.pop(),l.text(f.join(" ")),f=[a],l=d.append("tspan").attr("x",i).attr("y",j).attr("dy",++g*h+k+"em").text(a))})}var svg,logging=!0,arrow=0,patternId=0,color=["#7A7A7A","#BFBFBF","purple"];if(2==arguments.length){var data=[],runstr="queue()";sources.forEach(function(a,b){var c=(new Date).getTime(),d="d3.json";a.source.indexOf(".json")>-1&&(d="d3.json"),a.source.indexOf(".csv")>-1&&(d="d3.csv"),a.source.indexOf(".svg")>-1&&(d="d3.xml"),a.source.indexOf(".xlsx")>-1&&(d="d3.xml"),runstr+=sources.length-1!=b?".defer("+d+', "'+a.source+"?_="+c+'")':".defer("+d+', "'+a.source+"?_="+c+'").await(function(){for (i = 1; i < arguments.length; i++) { data[sources[i-1].name] = arguments[i];}; callback(data); });'}),console.log(runstr),eval(runstr)}var activeFrame=1,maxFrames=4;this.maxFrames=function(a){maxFrames=a},this.gotoFrame=function(a,b){loadFrame(a,b)},this.nextFrame=function(a){return activeFrame++,this.gotoFrame(activeFrame,a),activeFrame},this.prevFrame=function(a){return activeFrame-=1,this.gotoFrame(activeFrame,a),activeFrame},this.hide=function(a){var b=1e3,c=0,d=!1;if(a.fade&&(b=a.fade),a.delay&&(c=a.delay),a.destroy&&(d=a.destroy),void 0==a.object||""==a.object)return alert("hide: no object has been set - e.g. 'object': pie1"),!1;var e=a.object;e.transition().delay(c).duration(b).style("opacity",0),1==a.destroy&&e.remove()},this.show=function(a){var b=1e3,c=0,d=1;if(a.fade&&(b=a.fade),a.delay&&(c=a.delay),a.opacity&&(d=a.opacity),void 0==a.object||""==a.object)return alert("hide: no object has been set - e.g. 'object': pie1"),!1;var e=a.object;e.transition().delay(c).duration(b).style("opacity",d)},this.log=function(a){this.logging&&console.log(a)};var rounder=function(a){var b=Math.abs(a);return 100>b?10*Math.ceil(a/10):500>b?50*Math.ceil(a/50):1e3>b?100*Math.ceil(a/100):1e4>b?1e3*Math.ceil(a/1e3):void 0};this.createSvg=function(a){var b="100%",c="100%",d="svg",e=!1,f=2;if(void 0==a.div||""==a.div)return alert("createSvg: no div has been set - e.g. 'div': '#box1'"),!1;if(void 0==a.id||""==a.id)return alert("createSvg: no id has been set for the svg - e.g. 'id': 'svg1'"),!1;a.width&&(b=a.width),a.height&&(c=a.height),a.id&&(id=a.id),a["class"]&&(d=a["class"]),a.div&&(div=a.div),a.aspectRatio&&(f=a.aspectRatio),void 0!=a.downloadButton&&(e=a.downloadButton);var g=1200,h=g*f,i=$(div).width(),j=$(div).height();i/f>j&&$(div).width($(div).height()*f);var k=$(div).width();return $(div).height(k/f),window.onresize=function(a){$(div).width("100%"),$(div).height("100%");var b=$(div).width(),c=$(div).height();b/f>c&&$(div).width($(div).height()*f);var d=$(div).width();$(div).height(d/f)},this.svg=d3.select(div).append("svg").attr("id",id).attr("class",d).attr("height",c).attr("width",b).attr("viewBox","0 0 "+g+" "+h).attr("preserveAspectRatio","xMinYMin slice"),void 0!=a.frame&&(vector=frameHandler(a.frame,this.svg)),this.svg},this.svgImport=function(a){var b="./images/MyLayer.svg",c="MyLayer",d=1,e=0,f=0;if(a.source&&(b=a.source),a.layerId&&(c=a.layerId),a.opacity&&(d=a.opacity),a.fade&&(e=a.fade),a.delay&&(f=a.delay),console.log(a),void 0==a.appendTo||""==a.appendTo)return alert("svgImport: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var g=a.appendTo,h=b.getElementById(c);g.node().appendChild(h),d3.selectAll("#"+c).attr("transform","translate(0,0)scale(0.83)")},this.rect=function(a){var b="green",c=50,d=50,e=2,f="darkgreen",g="rectangle",h=1,i=0,j=0,k=0,l=0;if(a.fill&&(b=a.fill),a.width&&(c=a.width),a.height&&(d=a.height),a.strokeWidth&&(e=a.strokeWidth),a.strokeColor&&(f=a.strokeColor),a.opacity&&(h=a.opacity),a.thisClass&&(g=a.thisClass),a.x&&(k=a.x),a.y&&(l=a.y),a.fade&&(i=a.fade),a.delay&&(j=a.delay),void 0==a.appendTo||""==a.appendTo)return alert("rect: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var m=a.appendTo,n=m.append("rect").attr("x",k).attr("y",l).attr("width",c).attr("height",d).style("fill",b).style("stroke",f).style("stroke-width",e).style("opacity",h);return n},this.tableBar=function(a){var b="tablebar",c="tableBar1",d=1,e=0,f=0,g=5,h=0,i=0,j="green",k=1,l=0,m=300,n=300,o=50,p="Title",q=5;if(a.thisClass&&(b=a.thisClass),a.opacity&&(d=a.opacity),a.xOffset&&(e=a.xOffset),a.yOffset&&(f=a.yOffset),a.fade&&(h=a.fade),a.delay&&(i=a.delay),a.source&&(s=a.source),a.innerRadius&&(innerRadius=a.innerRadius),void 0!==a.innerBorder&&(innerBorder=a.innerBorder),void 0!==a.enableText&&(enableText=a.enableText),a.fontSize&&(fontSize=a.fontSize),a.padding&&(l=a.padding),a.height&&(m=a.height),a.width&&(n=a.width),a.title&&(p=a.title),a.limit&&(g=a.limit),a.valueField&&(valueField=a.valueField),a.nameField&&(nameField=a.nameField),a["class"]&&(b=a.thisClass),a.id&&(c=a.id),a.fill&&(j=a.fill),a.fillOpacity&&(k=a.fillOpacity),void 0==a.appendTo||""==a.appendTo)return alert("pie: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var r=a.appendTo;s.sort(function(a,b){return+b.values.total-+a.values.total});var s=s.filter(function(a){return"undefined"!==a.key&&"TBD"!==a.key}),t=d3.max(s,function(a){var b=a.values.total;return b}),u=d3.scale.linear().range([0,n-o]).domain([0,t]),v=r.append("g").attr("id",c).attr("transform","translate("+e+","+f+")"),w=v.selectAll("."+b).data(s.filter(function(a,b){return g>b})).enter().append("g").attr("class",b).attr("transform",function(a,b){return"translate(0,"+(b*(m/g)+q)+")"}),x=["#00669E","#9CBED0"];w.selectAll(".rowBar").data(function(a,b){return a.values.bars}).enter().append("rect").attr("class","rowBar").attr("width",function(a){return u(a)}).style("fill",function(a,b){return x[b]}).style("fill-opacity",k).attr("height",m/g-q).attr("y",0).attr("x",function(a,b){var c;return c=b>0?d3.select(this.parentNode).datum().values.bars[b-1]:0,u(c)}).style("stroke","#FFF").style("stroke-opacity",.5),w.append("text").style("text-anchor","end").attr("y",11).attr("x",-5).style("font-size","10px").text(function(a){return a[nameField]});w.append("text").attr("y",12).attr("x",function(a){return u(a.values.total)+3}).style("font-size","11px").attr("fill",function(a,b){return x[0]}).style("font-weight","bold").text(function(a){return addCommas(a.values.bars[0])}).attr("class",function(a){return a.bWidth=d3.select(this).node().getBBox().width,"t1"});t2Divider=w.append("text").attr("y",12).attr("x",function(a){return u(a.values.total)+a.bWidth+4}).attr("fill","#B5B5B5").style("font-size","11px").style("font-weight","bold").text(function(a){return"|"}),t2=w.append("text").attr("fill",function(a,b){return x[1]}).attr("y",12).attr("x",function(a){return u(a.values.total)+a.bWidth+10}).style("font-size","11px").style("font-weight","bold").text(function(a){return addCommas(a.values.bars[1])});v.node().getBBox();void 0!=a.frame&&(v=frameHandler(a.frame,v))},this.pie=function(a){var b="pie",c="pie1",d=1,e=0,f=0,g=0,h=0,i=[5,3],j=.4,k=!0,l=!0,m="30px",n=0,o=300,p=300,q="";if(a.thisClass&&(b=a.thisClass),a.opacity&&(d=a.opacity),a.x&&(e=a.x),a.y&&(f=a.y),a.fade&&(g=a.fade),a.delay&&(h=a.delay),a.data&&(i=a.data),a.innerRadius&&(j=a.innerRadius),void 0!==a.innerBorder&&(k=a.innerBorder),void 0!==a.enableText&&(l=a.enableText),a.fontSize&&(m=a.fontSize),a.padding&&(n=a.padding),a.height&&(o=a.height),a.width&&(p=a.width),a.title&&(q=a.title),a.colorArray&&(color=a.colorArray),void 0==a.appendTo||""==a.appendTo)return alert("pie: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var r=a.appendTo;if(void 0==a.id||""==a.id)return alert("pie: no id has been set - e.g. 'id': svg1"),!1;var c=a.id,s=i,t=Math.min(p/2,$("#"+r.attr("id")).height()/2),t=t-n,u=d3.svg.arc().outerRadius(t-10).innerRadius(t-t*j),v=d3.layout.pie().sort(null).value(function(a){return a}),w=r.append("g").attr("id",c).attr("transform","translate("+parseInt(e)+","+parseInt(f)+")").style("opacity",d);""!==q&&(w.append("text").attr("x",-p/2+15).attr("y",-o/2).style("font-family","'Open Sans', sans-serif").style("font-weight","bold").style("font-size","16px").text(q),w.append("text").attr("id","pieTitleSub").attr("x",-p/2+95).attr("y",-o/2-1).style("font-family","'Open Sans', sans-serif").style("font-weight","normal").style("font-size","13px").text("(Nationwide)"));var x=w.selectAll(".arc").data(v(s)).enter().append("g").attr("class","arc"),x=w.selectAll("path").data(v(s)).enter().append("path").attr("d",u).style("fill",function(a,b){return color[b]}).each(function(a){this._current=a});if(1==l){var y=w.append("g");y.append("text").attr("class","piePercent").style("font-size",m).style("font-weight","bold").style("text-anchor","middle").text(function(a){var b=s[0]/(s[0]+s[1])*100;return Math.round(b)+"%"}).attr("y",function(){return this.getBBox().height/4}).style("opacity",0)}return this.innerRing&&w.append("circle").attr("r",function(){return t-t*j-2}).attr("cx",0).attr("cy",0).style("fill","transparent").style("stroke","#bfbfbf").style("stroke-width",1),x.update=function(a){function b(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return u(b(a))}}function c(a){var b=d3.interpolate(this._current,{startAngle:2*Math.PI,endAngle:2*Math.PI,value:0});return this._current=b(0),function(a){return u(b(a))}}var d=1e3;if(a.transition&&(d=a.transition),void 0==a.data||""==a.data)return alert("pie.update: no data has been set - e.g. 'data': [1,2,3]"),!1;var e=a.data;if(void 0==a.id||""==a.id)return alert("pie.update: no id has been set - e.g. 'id': '#pie1'"),!1;var f=a.id,g={startAngle:2*Math.PI,endAngle:2*Math.PI},h=d3.sum(e),i=d3.select(f),j=i.selectAll("path").data(v(e));j.enter().append("path").style("fill",function(a,b){return color[b]}).attr("d",u(g)).each(function(a){this._current={data:a.data,value:a.value,startAngle:g.startAngle,endAngle:g.endAngle}}),j.exit().transition().duration(d).attrTween("d",c).remove(),j.transition().duration(d).attrTween("d",b),i.select(".piePercent").text(function(a){var b=e[0]/(e[0]+e[1])*100;return Math.round(b)+"%"});var k=i.selectAll("path").on("mouseover",function(a,b){var c=a.value/h*100;d3.select(".piePercent").text(Math.round(c)+"%").transition().duration(250).style("opacity",1)}).on("mouseout",function(a){d3.select(".piePercent").transition().duration(250).style("opacity",0)});return k},void 0!=a.frame&&(w=frameHandler(a.frame,w)),x},this.lineChart=function(){var a=function(){this.data=[{date:"2011-08-01",value:120},{date:"2011-08-03",value:10},{date:"2011-08-04",value:16},{date:"2011-08-11",value:113},{date:"2011-09-01",value:90},{date:"2011-09-02",value:11},{date:"2011-09-05",value:14},{date:"2011-10-05",value:134},{date:"2011-11-05",value:324}],this.color=color[0],this.barSpace=.43,this.yAxisEnabled=!0,this.dataLabelsEnabled=!0,this.yAxisGrid=!0,this.cumulative=!1,this.xAxisFormat="%b %Y",this.spline=!1,this.area=!0,this.create=function(a){var b=this.cumulative,c={top:38,right:15,bottom:25,left:40};0==this.yAxisEnabled&&(c.left=c.right);var d=$("#"+a.attr("id")).width()-c.left-c.right,e=$("#"+a.attr("id")).height()-c.top-c.bottom,f=(this.color,this.data),g=d3.time.format("%Y-%m-%d").parse,h=0;f.forEach(function(a){a.date=g(a.date),1==b?(h+=a.value,a.value=h):a.value=+a.value});var i=d3.time.scale().range([0,d]).domain(d3.extent(f,function(a){return a.date})),j=d3.max(f,function(a){return a.value}),k=d3.scale.linear().range([e,0]).domain([0,rounder(j)]),l=d3.svg.axis().scale(i).orient("bottom").tickSize(3,0,0).ticks(d3.time.months,1).tickFormat(d3.time.format(this.xAxisFormat)),m=d3.svg.axis().scale(k).orient("left").ticks(4).tickPadding(0);if(0==this.area)var n=d3.svg.line().x(function(a){return i(a.date)}).y(function(a){return k(a.value)});else var n=d3.svg.area().x(function(a){return i(a.date)}).y0(e).y1(function(a){return k(a.value)});1==this.spline&&n.interpolate("monotone");var o=a.append("g").attr("class","lineChart").attr("transform","translate("+c.left+","+c.top+")");if(1==this.yAxisEnabled&&o.append("g").attr("class","yAxis axis").call(m).append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",-36).attr("dy",".71em").attr("x",-e/2+25).style("text-anchor","end"),1==this.yAxisGrid){var p=m.tickSize(d,0).tickFormat("").orient("right");o.append("g").classed("y",!0).classed("grid",!0).call(p)}var q=Math.abs(i(new Date("2011-01-01"))-i(new Date("2011-02-01")))/2;o.append("g").attr("class","xAxis axis").attr("transform","translate(0,"+e+")").call(l).selectAll(".lineChart .tick text").style("text-anchor","middle").attr("x",q).attr("y",5);var n=o.append("path").datum(f).attr("class","line").attr("d",n).style("stroke",color[0]).style("stroke-width","1.5px");return 1==this.area&&n.style("fill",color[0]),o}};return new a},this.columnChart=function(){var a=function(){this.data=[{series:"Cats",value:120},{series:"Dogs",value:10},{series:"Giraffes",value:16},{series:"Ostriches",value:113},{series:"Lions",value:90},{series:"Cheetahs",value:11},{series:"Elephants",value:14}],this.color=["#00937F"],this.barSpace=.43,this.yAxisEnabled=!0,this.dataLabelsEnabled=!0,this.yAxisGrid=!0,this.create=function(a){var b={top:38,right:15,bottom:25,left:40};0==this.yAxisEnabled&&(b.left=b.right);var c=$("#"+a.attr("id")).width()-b.left-b.right,d=$("#"+a.attr("id")).height()-b.top-b.bottom,e=this.color,f=this.data,g=d3.scale.ordinal().rangeRoundBands([0,c],this.barSpace).domain(f.map(function(a){return a.series})),h=d3.max(f,function(a){return a.value}),i=d3.scale.linear().range([d,0]).domain([0,rounder(h)]),j=d3.svg.axis().scale(g).orient("bottom").tickSize(0).tickPadding(7),k=d3.svg.axis().scale(i).orient("left").ticks(3).tickPadding(0),l=a.append("g").attr("class","columnChart").attr("transform","translate("+b.left+","+b.top+")");if(1==this.yAxisEnabled&&l.append("g").attr("class","yAxis axis").call(k).append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",-36).attr("dy",".71em").attr("x",-d/2+25).style("text-anchor","end"),1==this.yAxisGrid){var m=k.tickSize(c,0).tickFormat("").orient("right");l.append("g").classed("y",!0).classed("grid",!0).call(m)}l.append("g").attr("class","xAxis axis").attr("transform","translate(0,"+d+")").call(j);var n=l.selectAll(".bar").data(f).enter().append("g").attr("class","bar");return n.append("rect").attr("x",function(a){return g(a.series)}).attr("width",g.rangeBand()).attr("y",function(a){return i(a.value)}).attr("height",function(a){return d-i(a.value)}).style("fill",function(a,b){return e.length>1?e[b]:e[0]}).on("mouseover",function(a,b){d3.select(this).style("fill",function(a,b){return e.length>1?e[b]:d3.rgb(e[0]).brighter(.4)})}).on("mouseout",function(a,b){d3.select(this).style("fill",function(a,b){return e.length>1?e[b]:e[0]})}),1==this.dataLabelsEnabled&&n.append("svg:text").attr("class","dataLabel").attr("x",function(a){return g(a.series)+g.rangeBand()/2}).attr("y",function(a){return i(a.value)-3}).style("text-anchor","middle").text(function(a){return a.value}),l}};return new a},this.bubbleChart=function(a){var b="green",c=2,d="darkgreen",e="rectangle",f=1,g=0,h=0,i=0,j=0,k="darkred";if(a.fill&&(b=a.fill),a.width&&(width=a.width),a.height&&(height=a.height),a.strokeWidth&&(c=a.strokeWidth),a.strokeColor&&(d=a.strokeColor),a.opacity&&(f=a.opacity),a.thisClass&&(e=a.thisClass),a.xOffset&&(i=a.xOffset),a.yOffset&&(j=a.yOffset),a.fade&&(g=a.fade),a.delay&&(h=a.delay),a.source&&(source=a.source),void 0==a.appendTo||""==a.appendTo)return alert("rect: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var l=a.appendTo;this.barSpace=.43,this.yAxisEnabled=!0,this.dataLabelsEnabled=!0,this.yAxisGrid=!0;var m={top:28,right:25,bottom:25,left:35};0==this.yAxisEnabled&&(m.left=m.right);var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=a.source.features,p=d3.time.scale().range([0,width]).domain(d3.extent(o,function(a){return a.properties.time})),q=p.domain()[0];q.setDate(q.getDate()-1),q.setHours(23),q.setMinutes(59),q.setSeconds(0),p.domain([q,p.domain()[1]])[0];var r=d3.max(o,function(a){return a.properties.mag}),s=d3.min(o,function(a){return a.properties.mag}),t=d3.scale.linear().range([height,0]).domain([s,Math.ceil(r)]),u=d3.scale.linear().domain([s,r]).range([0,30]),v=d3.scale.sqrt().domain([s,r]).range([.1,.5]),w=d3.scale.linear().domain([s,r]).range([.1,3]),x=d3.svg.axis().scale(p).orient("bottom").tickSize(0).ticks(4).tickPadding(5).tickFormat(d3.time.format("%d April")),y=d3.svg.axis().scale(t).orient("left").ticks(4).tickPadding(0),z=l.append("g").attr("class","bubbleChart").attr("transform","translate("+i+","+j+")");if(z.append("text").attr("x",-30).attr("y",-45).style("font-family","'Open Sans', sans-serif").style("font-weight","bold").style("font-size","16px").text("Earthquakes and aftershocks"),z.append("text").attr("x",-29).attr("y",-25).style("font-family","Arial").style("font-weight","bold").style("font-size","12px").text("Source:"),z.append("text").attr("x",18).attr("y",-25).style("font-family","arial").style("font-weight","normal").style("font-size","12px").text("USGS"),1==this.yAxisEnabled&&z.append("g").attr("class","yAxis axis").call(y).append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",-28).attr("dy",".71em").attr("x",-height/2+25).style("text-anchor","end").style("font-weight","bold").text("Magnitude"),1==this.yAxisGrid){var A=y.tickSize(width,0).tickFormat("").tickPadding(30).orient("right");z.append("g").classed("y",!0).classed("grid",!0).call(A)}z.append("g").attr("class","xAxis axis").attr("transform","translate(0,"+height+")").call(x);var B=x.tickSize(height,0).tickFormat("").tickPadding(0).orient("bottom");z.append("g").classed("x",!0).classed("xgrid",!0).call(B);var C=z.selectAll(".bubble").data(o).enter().append("g").attr("class","bubble");return C.append("circle").attr("cx",function(a,b){var c=new Date(a.properties.time),d=c.getDate(),e=c.getMonth(),f=c.getFullYear();d+" "+n[e]+" "+f;return p(a.properties.time)}).attr("cy",function(a){return t(a.properties.mag)}).attr("r",function(a){return u(a.properties.mag)}).style("fill-opacity",function(a){return v(a.properties.mag)}).style("stroke-opacity",function(a){return v(a.properties.mag)}).attr("id",function(a){return"chart"+a.id}).attr("class","chartbubble").style("stroke","#570809").style("stroke-width",function(a){return w(a.properties.mag)}).style("fill",k).on("mouseover",function(a,b){d3.select(this).style("stroke-opacity",1);var c=new Date(a.properties.time),d=c.toTimeString().substring(0,5),c=c.getDate()+" "+n[c.getMonth()]+" "+c.getFullYear()+" - "+d;d3.select(".mTitle").text("M"+a.properties.mag),d3.select(".mSubTitle1").text(c),d3.select("#dM2").style("opacity",1);var e=a.id;d3.selectAll(".mapbubble").style("opacity",function(a){return a.id==e?1:.2}).style("stroke-opacity",function(a){return a.id==e?1:.2})}).on("mouseout",function(a,b){d3.selectAll(".mapbubble").style("opacity",1).style("stroke-opacity",function(a){return v(a.properties.mag)});d3.select(this).style("stroke-opacity",function(a){return v(a.properties.mag)}),d3.select("#dM2").style("opacity",0).attr("transform","translate(-100,-100)")}).on("mousemove",function(a,b){var c=d3.transform(d3.select(this).attr("transform")),d=c.translate[0],e=c.translate[1];coordinates=d3.mouse(this);var f=coordinates[0]+d+i,g=coordinates[1]+e+j;d3.select("#dM2").attr("transform","translate("+(f+13)+","+(g+5)+")")}),void 0!=a.frame&&(z=frameHandler(a.frame,z)),z},this.map=function(a){function b(){if(D.scale(M.scale()/2/Math.PI).translate(M.translate()),H.selectAll(".geopoly path").attr("d",F),H.selectAll(".vector").attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"}),L.attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"}),d3.selectAll("#centerAnchor").node()){var a=d3.transform(L.attr("transform")).translate;d3.selectAll(".import").each(function(b){var c=d3.select(this).select("#anchor");if(c.node()){var d=c.node().getBBox(),e=a[0]-(d.x+d.width/2),f=a[1]-(d.y+d.height/2);d3.select(this).attr("transform","translate("+e+","+f+")")}})}H.selectAll(".symbolPoint").attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"}),H.selectAll(".textLabel").attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"}),H.selectAll(".districtLabels").attr("transform",function(a){return"translate("+D([a.centroid_x,a.centroid_y])+")"}),H.selectAll(".styledLabel").attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"});var b=d3.svg.line().x(function(a){return e=D([a.lon,a.lat]),e[0]}).y(function(a){return e=D([a.lon,a.lat]),e[1]}).interpolate("basis");H.selectAll(".arrow").attr("d",b);if(1==f){var c=C.scale(M.scale()).translate(M.translate())(),g=G.attr("transform","scale("+c.scale+")translate("+c.translate+")").selectAll("image").data(c,function(a){return a});g.exit().remove(),g.enter().append("image").attr("xlink:href",function(a){return"http://"+["a","b","c","d"][4*Math.random()|0]+".tiles.mapbox.com/v3/"+d+"/"+a[2]+"/"+a[0]+"/"+a[1]+".png"}).attr("width",1).attr("height",1).style("opacity",1).attr("class","imgtile").attr("x",function(a){return a[0]}).attr("y",function(a){return a[1]})}}var c=[44,33],d="matthewsmawfield.31370f48",f=!0,g=!0,h=!0,i=!0,j=14,k=3,l=3,m=1.5,n=!0,o=!0,p=!1,q=0,r=0;a.center&&(c=a.center),a.xOffset&&(q=a.xOffset),a.yOffset&&(r=a.yOffset),a.zoomInit&&(j=a.zoomInit),a.mapbox&&(d=a.mapbox),void 0!=a.enableRaster&&(f=a.enableRaster),void 0!=a.enablePan&&(i=a.enablePan),void 0!=a.enableZoomButtons&&(g=a.enableZoomButtons),void 0!=a.enableZoomMouseScroll&&(h=a.enableZoomMouseScroll),a.zoomInSteps&&(k=a.zoomInSteps),a.zoomOutSteps&&(l=a.zoomOutSteps),a.zoomFactor&&(m=a.zoomFactor),void 0!=a.coordinatesTooltip&&(n=a.coordinatesTooltip),void 0!=a.coordinatesToClipboard&&(o=a.coordinatesToClipboard),void 0!=a.enableDownload&&(p=a.enableDownload);var s=a.appendTo,t=s.attr("viewBox").split(" "),u=t[2],v=t[3],w=u,z=u/v,A=u*z,B=s.append("g").attr("id","mapsvgcontainer").attr("mask","url(#mask)");if(1==f)var C=d3.geo.tile().size([w,A]);var D=d3.geo.mercator().scale((1<<j)/2/Math.PI*.98).translate([0,0]),E=D([c[0],c[1]]),F=d3.geo.path().projection(D),G=B.append("g").attr("id","raster"),H=B.append("g").attr("id","vector"),I=B.append("g").attr("id","maskLayer"),J=s.append("g").attr("id","customLayer"),K=[{lat:c[1],lon:c[0]}],L=J.selectAll("#centerAnchor").data(K).enter().append("g").attr("id","centerAnchor").attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"}).style("opacity",0);L.append("circle").attr("cx",0).attr("cy",0).attr("r",5).attr("id","anchor").style("fill-opacity",0).style("stroke-opacity",0).style("stroke","blue");var M=d3.behavior.zoom().scale(2*D.scale()*Math.PI).translate([w/2-E[0]+q,A/2-E[1]+r]).on("zoom",b),N=.94,O=M.scale(),P=M.translate(),Q=[w/2,A/2];M.scale(O*N).translate([Q[0]+(P[0]-Q[0])/O*O*N,Q[1]+(P[1]-Q[1])/O*O*N]),B.call(M);M.translate(),M.scale();b();var R=s.attr("id")+"coordinatesTooltip";if(B.on("mousemove",function(){if(1==n){var a=D.invert(d3.mouse(this));$("#"+R+" #lon").text(a[0].toFixed(6)),$("#"+R+" #lat").text(a[1].toFixed(6))}}).on("dblclick",function(){if(1==o){var a=D.invert(d3.mouse(this)),b="{name: 'name', lat: "+a[1].toFixed(6)+", lon: "+a[0].toFixed(6)+"},";window.prompt("Copy to clipboard: Ctrl+C, Enter",b)}}),1==n)var S=$(B[0]).parent("svg").parent("div"),s=$(B[0]).parent("svg"),T=s.attr("class"),Q=$(S).append('<div id="'+R+'" class="coordinatesTooltip '+T+'"><i class="fa fa-crosshairs"></i>&nbsp;Latitude: <span id="lat">34.123</span> | Longitude: <span id="lon">43.12</span></div>');if(0==h&&B.on("mousewheel.zoom",null).on("dblclick.zoom",null).on("DOMMouseScroll.zoom",null).on("wheel.zoom",null),0==i&&B.on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),1==g){var S=$(B[0]).parent("svg").parent("div"),s=$(B[0]).parent("svg"),T=s.attr("class"),U=S.attr("id"),V=s.attr("id")+"zoomBox",W='<div id="'+V+'" class="zoomBox"><div class="zoom zoomIn"></div><div class="zoom zoomOut"></div></div>';$("#"+U).append(W);$("#"+V+" .zoomIn").on("click",function(){if(M.scale()<(1<<j)*Math.pow(m,k)){var a=M.scale(),c=(M.scaleExtent(),a*m),d=M.translate(),e=[w/2,A/2];M.scale(c).translate([e[0]+(d[0]-e[0])/a*c,e[1]+(d[1]-e[1])/a*c]),b(),M.scale()<(1<<j)*Math.pow(m,k)?($("#"+S.attr("id")+" .zoomIn").removeClass("disabled"),$("#"+S.attr("id")+" .zoomOut").removeClass("disabled")):($("#"+S.attr("id")+" .zoomIn").addClass("disabled"),$("#"+S.attr("id")+" .zoomOut").removeClass("disabled"))}}),$("#"+V+" .zoomOut").on("click",function(){if(M.scale()>(1<<j)/Math.pow(m,l)){var a=M.scale(),c=(M.scaleExtent(),a/m),d=M.translate(),e=[w/2,A/2];M.scale(c).translate([e[0]+(d[0]-e[0])/a*c,e[1]+(d[1]-e[1])/a*c]),b(),M.scale()>(1<<j)/Math.pow(m,l)?($("#"+S.attr("id")+" .zoomIn").removeClass("disabled"),$("#"+S.attr("id")+" .zoomOut").removeClass("disabled")):($("#"+S.attr("id")+" .zoomIn").removeClass("disabled"),$("#"+S.attr("id")+" .zoomOut").addClass("disabled"))}})}return B.downloader=function(){var a=($(B[0]).parent("svg").attr("id"),$(B[0]).parent("svg").parent("div")),b=document.getElementById(id);d3.select("#"+a.attr("id")).append("a").attr("href","#").text("download").style({position:"absolute",top:"20px",left:"10px"}).attr("download","download.svg").on("click",function(){var a=s.attr("width"),c=s.attr("height");s.attr("height",1e3).attr("width",1e3);var d=new XMLSerializer,e=d.serializeToString(b);d3.select(this).attr("href","data:Application/octet-stream;filename=download.svg,"+encodeURIComponent(e)),s.attr("height",c).attr("width",a)})},B.addVectorPolygon=function(a){var b,c="polygon",d=2,e="blue",f=.1,g="cyan",h=1,c="polygonPatternFill",i=1,j=0,k=0;a.strokeWidth&&(d=a.strokeWidth),a.strokeColor&&(e=a.strokeColor),void 0!=a.strokeOpacity&&(f=a.strokeOpacity),a.fill&&(g=a.fill),void 0!=a.fillOpacity&&(h=a.fillOpacity),a.opacity&&(i=a.opacity),a["class"]&&(c=a["class"]),a.fade&&(j=a.fade),a.delay&&(k=a.delay);var l=topojson.feature(a.source,a.source.objects[Object.keys(a.source.objects)[0]]).features;return b=H.selectAll("."+c).data(l).enter().append("g").attr("class","geopoly"),void 0!=a.frame&&(b=frameHandler(a.frame,b)),b=b.append("path").attr("class",c).attr("d",F).attr("id",function(a){return a.id}).style("fill",function(a){return g}).style("fill-opacity",h).style("stroke",e).style("stroke-width",d).style("stroke-opacity",f).on("mouseover",function(a){}).on("mouseout",function(a){})},B.addVectorPolygonPatternFill=function(a){var b=1,c=2,d="blue",e="polygonPatternFill",f=1,g=0,h=0;a.lineSpace&&(b=a.lineSpace),a.strokeWidth&&(c=a.strokeWidth),a.strokeColor&&(d=a.strokeColor),a.opacity&&(f=a.opacity),a["class"]&&(e=a["class"]),a.source&&(source=a.source),a.fade&&(g=a.fade),a.delay&&(h=a.delay);var i=topojson.feature(a.source,a.source.objects[Object.keys(a.source.objects)[0]]).features;patternId+=1;var j=(B.append("defs").append("pattern").attr("id","pattern"+patternId).attr("patternUnits","userSpaceOnUse").attr("width",4+b).attr("height",4+b).append("path").attr("d","M-1,1 l"+(2+b)+",-"+(2+b)+" M0,"+(4+b)+" l"+(4+b)+",-"+(4+b)+" M"+(3+b)+","+(5+b)+" l"+(2+b)+",-"+(2+b)).style("stroke",d).style("stroke-width",c),H.selectAll("."+e).data(i).enter().append("g").attr("class","geopoly").style("opacity",1)),k=j.append("path").attr("class",e).attr("d",F).attr("id",function(a){return a.id}).style("fill","url(#pattern"+patternId+")").style("opacity",0).on("mouseover",function(a){}).on("mouseout",function(a){});return k.transition().delay(h).duration(g).style("opacity",f),void 0!=a.frame&&(j=frameHandler(a.frame,j)),j},B.addVectorPoints=function(a){var b=a.source,c=d3.max(b,function(a){return+a.idps}),d=(d3.scale.sqrt().domain([0,c]).range([0,40]),d3.scale.sqrt().domain([0,c]).range([.6,.75])),e=d3.scale.sqrt().domain([0,c]).range([.7,1.6]);vectorGroup=H.selectAll("."+a["class"]).data(b).enter().append("g").attr("class","vector").style("opacity",1).attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"});vectorGroup.append("circle").attr("class",a["class"]).attr("cx",0).attr("cy",0).attr("r","2px").style("stroke","black").style("stroke-width",1).style("fill","red"),vectorGroup.append("text").attr("y",-5).style("text-anchor","middle").style("fill","#575757").style("opacity",0).style("font-family","'Open Sans', sans-serif").style("font-size",function(a){return d(a.idps).toFixed(2)+"em"}).style("font-weight","normal").text(function(a){return a.name}).transition().duration(2500).delay(1e3).style("opacity",1),vectorGroup.append("text").style("text-anchor","middle").style("fill","#0a4623").style("fill-opacity",0).style("font-family","'Open Sans', sans-serif").style("font-size",function(a){return e(a.idps).toFixed(2)+"em"}).style("font-weight","bold").text(function(a){return addCommas(a.idps)}).attr("y",function(){var a=d3.select(this).node().getBBox();return a.height/2}).transition().duration(2500).delay(1e3).style("fill-opacity",.7);return void 0!=a.frame&&(vectorGroup=frameHandler(a.frame,vectorGroup)),vectorGroup},B.addEarthquake=function(a){var b="darkred",c=a.source.features,d=(a.size,9);c.sort(function(a,b){return+b.properties.mag-+a.properties.mag});var d=d3.max(c,function(a){return a.properties.mag}),e=d3.min(c,function(a){return a.properties.mag}),f=d3.scale.linear().domain([e,d]).range([0,30]),g=d3.scale.sqrt().domain([e,d]).range([.1,.5]),h=d3.scale.linear().domain([e,d]).range([.1,2]);d3.scale.sqrt().domain([e,d]).range([.6,.85]),d3.scale.linear().domain([e,d]).range([0,2.5]);return vectorGroup=H.selectAll("."+a["class"]).data(c).enter().append("g").attr("class","vector").attr("transform",function(a){return"translate("+D([a.geometry.coordinates[0],a.geometry.coordinates[1]])+")"}).on("mousemove",function(a,b){var c=d3.transform(d3.select(this).attr("transform")),d=c.translate[0],e=c.translate[1];coordinates=d3.mouse(this);var f=coordinates[0]+d,g=coordinates[1]+e;d3.select("#dM2").attr("transform","translate("+(f+13)+","+(g+5)+")")}).on("mouseout",function(a,b){d3.select("#dM2").attr("transform","translate(-100,-100)")}),vectorGroup.append("circle").attr("class",a["class"]).attr("cx",0).attr("cy",0).attr("r",function(a){return f(a.properties.mag)}).style("fill-opacity",function(a){return g(a.properties.mag)}).style("stroke-opacity",function(a){return g(a.properties.mag)}).attr("id",function(a){return"map"+a.id}).attr("class","mapbubble").style("stroke","#570809").style("stroke-width",function(a){
return h(a.properties.mag)}).style("fill",b).on("mouseover",function(a,b){var c=new Date(a.properties.time),d=c.toTimeString().substring(0,5),c=c.getDate()+" "+monthNames[c.getMonth()]+" "+c.getFullYear()+" - "+d;d3.select(".mTitle").text("M"+a.properties.mag),d3.select(".mSubTitle1").text(c),d3.select("#dM2").style("opacity",1),d3.select(this).style("stroke-opacity",1);var e=a.id;d3.selectAll(".chartbubble").style("opacity",function(a){return a.id==e?1:.2}).style("stroke-opacity",function(a){return a.id==e?1:.2})}).on("mouseout",function(a,b){d3.select("#dM2").style("opacity",0);d3.selectAll(".chartbubble").style("opacity",1).style("stroke-opacity",function(a){return g(a.properties.mag)});d3.select(this).style("stroke-opacity",function(a){return g(a.properties.mag)})}),void 0!=a.frame&&(vectorGroup=frameHandler(a.frame,vectorGroup)),vectorGroup},B.addProportionalCircles=function(a){var b=[{name:"zero",lat:0,lon:0}],c="idps",d="idps",e=1,f=.2,g=0,h=0,i="#0a4a25",j=!0,k="name";a.source&&(b=a.source),a.dataVariable&&(c=a.dataVariable),a.circleClass&&(d=a.circleClass),a.opacity&&(e=a.opacity),a.circleOpacity&&(f=a.circleOpacity),a.color&&(i=a.color),a.fade&&(g=a.fade),a.delay&&(h=a.delay),void 0!=a.showTextLabel&&(j=a.showTextLabel),a.textVariable&&(k=a.textVariable);var l,m=a.source,n=d3.max(m,function(a){return+a[c]}),o=d3.scale.sqrt().domain([0,n]).range([0,40]),p=d3.scale.sqrt().domain([0,n]).range([.6,.75]),q=d3.scale.sqrt().domain([0,n]).range([.7,1.6]);vectorGroup=H.selectAll("."+a["class"]).data(m).enter().append("g").classed({vector:!0}).style("opacity",e).attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"});var l=vectorGroup.append("circle").attr("class",a["class"]).attr("cx",0).attr("cy",0).attr("r",0).style("stroke",i).style("stroke-width",1).style("stroke-opacity",1).style("fill",i).style("fill-opacity",.5).style("opacity",0);if(l.transition().duration(g).delay(h/2).attr("r",function(a,b){return o(a[c])}).style("opacity",f),1==j){vectorGroup.append("text").attr("class","textName").attr("y",-5).style("text-anchor","middle").style("fill",i).style("opacity",0).style("font-family","'Open Sans', sans-serif").style("font-size",function(a){return p(a[c]).toFixed(2)+"em"}).style("font-weight","normal").text(function(a){return a[k]}).transition().duration(g).delay(h).style("opacity",1),vectorGroup.append("text").attr("class","textFigure").style("text-anchor","middle").style("fill",i).style("fill-opacity",0).style("font-family","'Open Sans', sans-serif").style("font-size",function(a){return q(a[c]).toFixed(2)+"em"}).style("font-weight","bold").text(function(a){return addCommas(a[c])}).attr("y",function(){var a=d3.select(this).node().getBBox();return a.height/2}).transition().duration(g).delay(h).style("fill-opacity",.7)}return vectorGroup.update=function(a){var b=a.dataVariable,c=a.duration,d=a.color;this.selectAll("circle").transition().duration(c).style("fill",d).style("stroke",d).attr("r",function(a,c){return o(a[b])}),this.selectAll(".textName").transition().duration(c).style("font-size",function(a){return p(a[b]).toFixed(2)+"em"}).text(function(a){return a[k]}),this.selectAll(".textFigure").transition().duration(c).style("fill",d).style("font-size",function(a){return q(a[b]).toFixed(2)+"em"}).attr("y",function(a){return 6*q(a[b])+3}).tween("text",function(a){var c=d3.interpolate(this.textContent.replace(/\,/g,""),a[b]),d=(a[b]+"").split("."),e=d.length>1?Math.pow(10,d[1].length):1;return function(a){this.textContent=addCommas(Math.round(c(a)*e)/e)}})},void 0!=a.frame&&(vectorGroup=frameHandler(a.frame,vectorGroup)),vectorGroup},B.addSymbolPoints=function(a){var b=12,c="normal",d="#000",e="'Open Sans', sans-serif",f="normal",g=1,h="symbol",i=12,j=12,k="./images/mapicons/Admin1Capital.svg",l=0,m=0,n=[{name:"Zero1",lat:2,lon:0}],o=0,p=0,q=0,r="right";if(void 0!=a.frame)var q=a.frame;a.source&&(n=a.source),a.fade&&(o=a.fade),a.delay&&(p=a.delay),a["class"]&&(h=a["class"]),a.orientation&&(r=a.orientation),a.hasOwnProperty("template")&&(a=symbolTemplate[a.template]),a.fontSize&&(b=a.fontSize),a.fontWeight&&(c=a.fontWeight),a.fontFamily&&(e=a.fontFamily),a.fontStyle&&(f=a.fontStyle),a.icon&&(k=a.icon),a.opacity&&(g=a.opacity),a.fontColor&&(d=a.fontColor),a.textAnchor&&(textAnchor=a.textAnchor),a.width&&(i=a.width),a.height&&(j=a.height),a.xOffset&&(l=a.xOffset),a.yOffset&&(m=a.yOffset);var s=H,t=s.selectAll(".symbolPoint ."+h).data(n).enter().append("g").style("opacity",1).attr("class","symbolPoint "+h).attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"}),u=t.append("text").text(function(a){return a.name}).style("font-family",e).style("font-style",f).style("fill",d).style("font-size",b).style("font-weight",c).attr("y",4);return"right"==r&&u.attr("x",8),"left"==r&&u.attr("x",function(){return-this.getBBox().width-7}),t.append("svg:image").attr("xlink:href",k).attr("width",i).attr("height",j).attr("x",-(j/2)-l).attr("y",-(i/2)-m).append("text").text(function(a){return a.name}),t.transition().delay(p).duration(o).style("opacity",g),0!=q&&(t=frameHandler(q,t)),t},B.addStyledLabels=function(a){var b="#000",c=1,d="styledLabel1",e=25,f="./images/labels/label1.svg",g=0,h=0,i=[{name:"Zero1",lat:2,lon:0}],j=0,k=0;a.source&&(i=a.source),a.fade&&(j=a.fade),a.delay&&(k=a.delay),a["class"]&&(symbolClass=a["class"]),a.fontStyle&&(fontStyle=a.fontStyle),a.labelSource&&(f=a.labelSource),a.opacity&&(c=a.opacity),a.color&&(b=a.color),a.textAnchor&&(textAnchor=a.textAnchor),a.size&&(e=a.size),a.xOffset&&(g=a.xOffset),a.yOffset&&(h=a.yOffset);var l;d3.xml(f,"image/svg+xml",function(f){var g=document.importNode(f.documentElement,!0);l=B.selectAll(".styledLabel").data(i).enter().append("g").style("opacity",1).attr("class","styledLabel "+d).attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"}).each(function(a,d){var f=a.name,h=this.appendChild(g.cloneNode(!0)),h=d3.select(h),i=h.attr("height",e).select("text"),l=(i.select("tspan").text(f),d3.select("body").append("svg")),m=l.append("text").text(f).style("font-size",function(){return i.style("font-size")}),n=l.node().getBBox();l.remove(),m.remove(),h.style("opacity",0).select("rect").attr("width",parseInt(n.width)+27).style("fill",b),h.select("path").style("fill",b),h.attr("width",parseInt(n.width)+66),h.attr("preserveAspectRatio","xMinYMin").attr("y",-(e/2)),h.transition().delay(k).duration(j).style("opacity",c)}),void 0!=a.frame&&(l=frameHandler(a.frame,l)),initFrame()})},B.addCustomLabels=function(a){var b=H.selectAll(".labelPoint .districtLabels").data(a.filter(function(a){return"undefined"!==a.key})).enter().append("g").style("opacity",.8).attr("class","districtLabels frame frame1").attr("transform",function(a){return"translate("+D([a.centroid_x,a.centroid_y])+")"});b.append("text").text(function(a){return a.name}).attr("x",0).attr("y",-1).style("font-family","'Open Sans', sans-serif").style("font-size",8).style("font-weight","bold").style("font-style","normal").style("fill","#000").style("fill-opacity",.8).style("text-anchor","middle").style("letter-spacing",.6).style("paint-order","stroke").style("stroke-linecap","butt").style("stroke-linejoin","miter").style("stroke","#fff").style("stroke-opacity",.5).style("stroke-width",1),b.append("text").text(function(a){return addCommas(a.values.total)}).attr("x",0).attr("y",11).style("font-family","'Open Sans', sans-serif").style("font-size",11).style("font-weight","bold").style("font-style","normal").style("fill","#003857").style("text-anchor","middle").style("letter-spacing",.6).style("paint-order","stroke").style("stroke-linecap","butt").style("stroke-linejoin","miter").style("stroke","#fff").style("stroke-opacity",.5).style("stroke-width",1)},B.addTextLabels=function(a){var b=12,c="normal",d="#000",e="'Open Sans', sans-serif",f="normal",g=1,h="middle",i="label",j=8,k=4,l=[{name:"Zero",lat:0,lon:0}],m=0,n=0;a.fontSize&&(b=a.fontSize),a.fontWeight&&(c=a.fontWeight),a.fontFamily&&(e=a.fontFamily),a.fontStyle&&(f=a.fontStyle),a.opacity&&(g=a.opacity),a.fontColor&&(d=a.fontColor),a.textAnchor&&(h=a.textAnchor),a["class"]&&(i=a["class"]),a.xOffset&&(j=a.xOffset),a.yOffset&&(k=a.yOffset),a.source&&(l=a.source),a.fade&&(m=a.fade),a.delay&&(n=a.delay);var o=H,p=o.selectAll(".labelPoint ."+i).data(l).enter().append("g").style("opacity",1).attr("class","textLabel "+i).attr("transform",function(a){return"translate("+D([a.lon,a.lat])+")"});return p.append("text").text(function(a){return a.name}).attr("x",j).attr("y",k).style("font-family",e).style("font-size",b).style("font-weight",c).style("font-style",f).style("fill",d).style("text-anchor",h).style("letter-spacing",.6),p.transition().delay(n).duration(m).style("opacity",g),void 0!=a.frame&&(p=frameHandler(a.frame,p)),p},B.zoomToBounds=function(a){dx=a[1][0]-a[0][0],dy=a[1][1]-a[0][1],x=(a[0][0]+a[1][0])/2,y=(a[0][1]+a[1][1])/2,scale=.9/Math.max(dx/w,dy/A),translate=[w/2-scale*x,A/2-scale*y],b()},B.addMask=function(a){var b=!1,c="mask";a.outline&&(b=a.outline),a["class"]&&(c=a["class"]),a.path&&(maskPath=a.path);var d=d3.svg.line().x(function(a){return e=D([a.lon,a.lat]),e[0]}).y(function(a){return e=D([a.lon,a.lat]),e[1]}).interpolate("cardinal-closed");$("body").append('<span id="svgFiltersTmp"></span>');$("#svgFiltersTmp").load("./images/filters.svg",null,function(){var e=$("#svgFiltersTmp svg defs");$(s).append(e);var f=I.append("g").attr("class",c).attr("fill-rule","evenodd").attr("x",0).attr("y",0).attr("transform",function(a){}),f=f.selectAll("#maskOutline").data([maskPath]).enter().append("path").attr("id","maskOutline").attr("d",function(a){return d(a)}).style("stroke","black").style("fill-opacity",0).style("fill","white");0==b&&f.style("fill-opacity",1).style("stroke","#FFF").style("filter","url(#blur111)");var g=f.attr("d");g="M-500,-500 L2000,0 L2000,2000 L0,2000 L-500,-500 Z "+g+" Z ",f.attr("d",g),void 0!=a.frame&&(f=frameHandler(a.frame,f))})},B.addLine=function(a){var b=H.append("path").datum({type:"LineString",coordinates:[a[0],a[1]]}).attr("class","route").attr("d",F).style("stroke","red").style("stroke-width",2);return b},B.addArrow=function(a){var b="#FFF",c=2,d=[{lat:44.42,lon:33.32},{lat:43,lon:29},{lat:43,lon:28}],f=1,g=0,h=0;a.color&&(b=a.color),a.strokeWidth&&(c=a.strokeWidth),a.source&&(d=a.source),a.opacity&&(f=a.opacity),a.fade&&(g=a.fade),a.delay&&(h=a.delay),arrow+=1,B.append("defs").append("marker").attr("id","arrowhead"+arrow).attr("refX",1).attr("refY",2).attr("markerWidth",3*c).attr("markerHeight",2*c).attr("orient","auto").append("path").attr("d","M 0,0 V 4 L6,2 Z").style("fill",b);var i=d3.svg.line().x(function(a){return e=D([a.lon,a.lat]),e[0]}).y(function(a){return e=D([a.lon,a.lat]),e[1]}).interpolate("basis"),j=H.selectAll(".path").data([d]);return j.enter().append("path"),j.attr("class","arrow").attr("d",function(a){return i(a)}).style("stroke",b).style("stroke-width",c).style("opacity",0).style("fill","none").attr("marker-end","url(#arrowhead"+arrow+")").style("stroke-linecap","round"),j.transition().delay(h).duration(g).style("opacity",f),void 0!=a.frame&&(j=frameHandler(a.frame,j)),j},B.svgImport=function(a){var b="./images/MyLayer.svg",c="MyLayer",d=1,e=0,f=0;a.source&&(b=a.source),a.layerId&&(c=a.layerId),a.opacity&&(d=a.opacity),a.fade&&(e=a.fade),a.delay&&(f=a.delay),d3.xml(b,function(b,g){var h=($(B[0]).parent("svg").attr("id"),g.getElementById(c));H.node().appendChild(h);var i=d3.select("#"+c).style("opacity",0).attr("class","import");if(d3.selectAll("#centerAnchor").node()){var j=d3.transform(L.attr("transform")).translate;d3.selectAll(".import").each(function(a){var b=d3.select(this).select("#anchor");if(b.node()){var c=b.node().getBBox(),d=j[0]-(c.x+c.width/2),e=j[1]-(c.y+c.height/2);d3.select(this).attr("transform","translate("+d+","+e+")")}})}d3.selectAll("#anchor").style("stroke-opacity",0),void 0!=a.frame&&(i=frameHandler(a.frame,i)),i.transition().delay(f).duration(e).style("opacity",d),initFrame()})},B.hexbin=function(a){var c="./images/MyLayer.svg",d="hex",e=1,f=.5,g="#bbbbbb",h=.5,i="red",j=0,k=0,l=15,m=["#F0B800","#DD0000"],n="auto";a.source&&(c=a.source),a.layerId&&(d=a.layerId),void 0!=a.opacity&&(e=a.opacity),void 0!=a.hexStrokeOpacity&&(h=a.hexStrokeOpacity),void 0!=a.meshStrokeOpacity&&(f=a.meshStrokeOpacity),a.meshStrokeColor&&(g=a.meshStrokeColor),a.hexStrokeColor&&(i=a.hexStrokeColor),a.fade&&(j=a.fade),a.radius&&(l=a.radius),a.delay&&(k=a.delay),a.colorRange&&(m=a.colorRange),a.max&&(n=a.max);var o=d3.hexbin().size([w,A]).radius(l).x(function(a){return D([a.lon,a.lat])[0]}).y(function(a){return D([a.lon,a.lat])[1]}),p=H.append("g").attr("id",d+"_mesh").attr("d",F);p.append("clipPath").attr("id","clip").append("rect").attr("d",F).attr("class",d+"_mesh").attr("width",w).attr("height",A),p.append("svg:path").attr("clip-path","url(#clip)").attr("d",o.mesh()).style("stroke-width",.5).style("stroke",g).style("stroke-opacity",f).style("fill","none");var q=o(c),r=H.append("g").attr("d",F).attr("id",d),s=0;"auto"!=n?s=a.max:$(q).each(function(){this.length>s&&(s=this.length)}),d3.select("#maxIntensity").text(s);var t=d3.scale.sqrt().domain([1,s]).range([.2,1]),u=d3.scale.linear().domain([1,s]).range([m[0],m[1]]).interpolate(d3.interpolateLab),v=r.selectAll(".hexagon").data(q).enter().append("path").attr("class","hexagon").attr("d",function(a){return o.hexagon()}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("fill",function(a){return u(a.length)}).style("fill-opacity",function(a){return t(a.length)}).style("stroke-width",.5).style("stroke",i).style("stroke-opacity",h);void 0!=a.frame&&(r=frameHandler(a.frame,r),p=frameHandler(a.frame,p));var x=function(){p.remove(),d3.selectAll("#"+d).remove(),p=H.append("g").attr("id",d+"_mesh").attr("d",F),p.append("clipPath").attr("id","clip").append("rect").attr("d",F).attr("class",d+"_mesh").attr("width",w).attr("height",A),p.append("svg:path").attr("clip-path","url(#clip)").attr("d",o.mesh()).style("stroke-width",.5).style("stroke",g).style("stroke-opacity",f).style("fill","none"),q=o(c),r=H.append("g").attr("d",F).attr("id",d),q=o(c),s=0,"auto"!=n?s=a.max:$(q).each(function(){this.length>s&&(s=this.length)}),u=d3.scale.linear().domain([1,s]).range([m[0],m[1]]).interpolate(d3.interpolateLab),v=r.selectAll(".hexagon").data(q).enter().append("path").attr("class","hexagon").attr("d",function(a){return o.hexagon()}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("fill",function(a){return u(a.length)}).style("fill-opacity",function(a){return t(a.length)}).style("stroke-width",.5).style("stroke",i).style("stroke-opacity",h),void 0!=a.frame&&(r=frameHandler(a.frame,r),p=frameHandler(a.frame,p))};M.on("zoom",function(){b(),activeFrame==a.frame&&x()}),$("#"+V+" .zoomIn").on("click",function(){x()}),$("#"+V+" .zoomOut").on("click",function(){x()}),void 0!=a.frame&&(r=frameHandler(a.frame,r),p=frameHandler(a.frame,p))},B}},symbolTemplate={countrycapital:{fontSize:12,fontWeight:"bold",fontColor:"#000",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"camps",width:11,height:11,icon:"./images/mapicons/CountryCapital.svg",xOffset:0,yOffset:0},admin1capital:{fontSize:12,fontWeight:"normal",fontColor:"#000",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"camps",width:10,height:10,icon:"./images/mapicons/Admin1Capital.svg",xOffset:0,yOffset:0},admin2capital:{fontSize:11,fontWeight:"normal",fontColor:"#000",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"camps",width:10,height:10,icon:"./images/mapicons/Admin2Capital.svg",xOffset:-1,yOffset:-.5},city:{fontSize:11,fontWeight:"normal",fontColor:"#333333",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"camps",width:6,height:6,icon:"./images/mapicons/City.svg",xOffset:-2,yOffset:-.5},poi:{fontSize:11,fontWeight:"bold",fontColor:"#333333",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"poi",width:6,height:6,icon:"./images/mapicons/POI.svg",xOffset:-2,yOffset:-.5},epicentre:{fontSize:12,fontWeight:"bold",fontColor:"#7D0302",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"epicentre",width:14,height:14,icon:"./images/mapicons/epicentre.svg",xOffset:0,yOffset:0},office0:{fontSize:12,fontWeight:"bold",fontColor:"#000000",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"office0",width:20,height:20,icon:"./images/mapicons/UNOffice.svg",xOffset:4,yOffset:0},office1:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"office1",width:17,height:17,icon:"./images/mapicons/Office1.svg",xOffset:2,yOffset:0},office2:{fontSize:9,fontWeight:"bold",fontColor:"#000000",fontFamily:"calibri",fontStyle:"normal",opacity:1,symbolClass:"office2",width:15,height:15,icon:"./images/mapicons/Office2.svg",xOffset:2,yOffset:0},office3:{fontSize:9,fontWeight:"bold",fontColor:"#000000",fontFamily:"calibri",fontStyle:"normal",opacity:1,symbolClass:"office3",width:15,height:15,icon:"./images/mapicons/Office3.svg",xOffset:2,yOffset:0},office4:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"office4",width:12,height:12,icon:"./images/mapicons/Office4.svg",xOffset:0,yOffset:0},office5:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"office5",width:12,height:12,icon:"./images/mapicons/Office5.svg",xOffset:0,yOffset:0},camp:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"camp",width:13,height:13,icon:"./images/mapicons/Camps.svg",xOffset:0,yOffset:0},location:{fontSize:10,fontWeight:"bold",fontColor:"#555555",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"location",width:13,height:13,icon:"./images/mapicons/UrbanLocation.svg",xOffset:0,yOffset:-2},totalpop:{fontSize:10,fontWeight:"bold",fontColor:"#555555",fontFamily:"arial",fontStyle:"normal",opacity:1,symbolClass:"location",width:13,height:13,icon:"./images/mapicons/totalpop.svg",xOffset:0,yOffset:-2}},monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dataSources=[{name:"adm1",source:"scripts/geo/topojson/adm1.json"},{name:"adm3",source:"scripts/geo/topojson/adm3.json"},{name:"adm3points",source:"scripts/geo/data/adm3points.csv"},{name:"adm4",source:"scripts/geo/topojson/adm4.json"},{name:"deaths",source:"scripts/geo/data/deaths.csv"},{name:"world",source:"scripts/geo/topojson/nepalregion2.json"},{name:"layout",source:"images/layout.svg"},{name:"shelter",source:"scripts/geo/data/unhcr.csv"}],ie=function(){for(var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0];);return b>4?b:a}();if(9>=ie)throw document.getElementById("loaderContent0").style.display="block",new Error("Visualisation does not support IE7/8/9");document.getElementById("loaderContent1").style.display="block";var sector=["WASH","Livelihood","Food security","Protection","Shelter","NFI","Health","Nutrition","Education","Communication","Humanitarian access"],severity=[1,2,3,3,4,5,6],color=["#00669E","#9CBED0"],colorGreyA=["#EFEFEF","#E9E9E9","#D4D4D4","#B7B7B7","#959595","#7A7A7A"],viz=new Vizlib(dataSources,function(a){function b(a){var b=$("#selectFrameDiv li:nth-child("+a+")").text();$("#selectFrame .textlabel").text(b)}console.log(a);var c=viz.createSvg({div:"#svgContainer",id:"mapsvg",frame:[1,2,3],aspectRatio:1.435,downloadButton:!1}),d=viz.map({appendTo:c,enableRaster:!0,center:[86.614935,27.252992],xOffset:220,yOffset:40,zoomInit:16,mapbox:"matthewsmawfield.31370f48",enableZoomButtons:!0,enableZoomMouseScroll:!1,enablePan:!0,zoomButtonsHtml:'<div class="zoomBox"><div class="zoom zoomIn"></div><div class="zoom zoomOut"></div></div>',zoomInSteps:1,zoomOutSteps:.1,zoomFactor:1.5,coordinatesTooltip:!0,coordinatesToClipboard:!1,frame:[1,2,3]});viz.svgImport({appendTo:c,source:a.layout,id:"layout",layerId:"Layout"});d3.select("#mapLegend").attr("class","frame frame1 frame2"),$("tspan").each(function(){var a=$(this).attr("font-family");"OpenSans-Bold"==a&&$(this).attr("font-family","'Open Sans', sans-serif;").css("font-weight","bold"),"OpenSans-Italic"==a&&$(this).attr("font-family","'Open Sans', sans-serif;").css("font-style","italic"),"OpenSans"==a&&$(this).attr("font-family","'Open Sans', sans-serif;")});var e=[],f=[],g=[],h=[];$.each(a.shelter,function(b,c){-1===$.inArray(c.type,e)&&c.type.length>1&&e.push(c.type),-1===$.inArray(c.partner,h)&&c.partner.length>1&&h.push(c.partner);var d;$.each(a.adm3.objects.adm3.geometries,function(a,b){c.district==b.properties.name&&(c.pcode=b.properties.pcode,d=c.pcode)});var i="NP-"+d;$.each(a.adm4.objects.adm4.geometries,function(a,b){i==b.properties.district_hrcode&&c.vdc==b.properties.name&&(c.vdc_pcode=b.properties.vdc_pcode)});var j=c.status.toLowerCase();c.items>0&&c.startdate.length>1&&(j.indexOf("completed")>-1||j.indexOf("ongoing")>-1)&&f.push(c),j.indexOf("pipeline")>-1&&g.push(c)}),c.append("text").attr("x",870).attr("y",40).style("font-size","20px").style("font-weight","bold").style("fill","darkred").text("ARCHIVED"),h.sort(d3.descending);var i="";$.each(h,function(a,b){i=b+", "+i}),d3.select("#partnerText tspan").call(wrap,480,i.substring(0,i.length-2));var j=d3.time.format("%d/%m/%y").parse,k=d3.nest().key(function(a){return a.startdate}).rollup(function(a){var b=d3.sum(a,function(a){return a.type==e[0]?parseInt(a.items.replace(/,/g,""),10):void 0}),c=d3.sum(a,function(a){return a.type==e[1]?parseInt(a.items.replace(/,/g,""),10):void 0});return isNaN(b)&&(b=0),isNaN(c)&&(c=0),{total:d3.sum(a,function(a){return parseInt(a.items.replace(/,/g,""),10)}),bars:[b,c]}}).entries(f),l=d3.nest().key(function(a){return a.pcode}).rollup(function(a){var b=d3.sum(a,function(a){return a.type==e[0]?parseInt(a.items.replace(/,/g,""),10):void 0}),c=d3.sum(a,function(a){return a.type==e[1]?parseInt(a.items.replace(/,/g,""),10):void 0});return isNaN(b)&&(b=0),isNaN(c)&&(c=0),{total:d3.sum(a,function(a){return parseInt(a.items.replace(/,/g,""),10)}),bars:[b,c]}}).entries(f),m=0;$.each(l,function(b,c){$.each(a.adm3points,function(a,b){c.key==b.ocha_pcode&&(m++,c.centroid_x=parseFloat(b.centroid_x),c.centroid_y=parseFloat(b.centroid_y))})});var n=d3.nest().key(function(a){return a.vdc_pcode}).rollup(function(a){var b=d3.sum(a,function(a){return a.type==e[0]?parseInt(a.items.replace(/,/g,""),10):void 0}),c=d3.sum(a,function(a){return a.type==e[1]?parseInt(a.items.replace(/,/g,""),10):void 0});return isNaN(b)&&(b=0),isNaN(c)&&(c=0),{total:d3.sum(a,function(a){return parseInt(a.items.replace(/,/g,""),10)}),bars:[b,c]}}).entries(f);d3.select("#chartTitle tspan").text(m+" RECEIVING DISTRICTS");var o=d3.sum(f,function(a){return a.type==e[0]?parseInt(a.items.replace(/,/g,""),10):void 0}),p=d3.sum(f,function(a){return a.type==e[1]?parseInt(a.items.replace(/,/g,""),10):void 0});d3.select("#PlasticSheets #ItemValue tspan").text(addCommas(o)),d3.select("#SolarLanterns #ItemValue tspan").text(addCommas(p));var q=d3.sum(g,function(a){return a.type==e[0]?parseInt(a.items.replace(/,/g,""),10):void 0}),r=d3.sum(g,function(a){return a.type==e[1]?parseInt(a.items.replace(/,/g,""),10):void 0});d3.select("#pipeLine #pipelinePlasticSheets tspan").text(addCommas(q)),d3.select("#pipeLine #pipelineSolarLamps tspan").text(addCommas(r));var s=d.addVectorPolygon({source:a.world,"class":"world",fillOpacity:0,strokeOpacity:1,strokeWidth:1,strokeColor:"#FFF",frame:[1,2,3]});s.style("fill",function(a){return"NP"!=a.properties.FIPS?"#E5E5E5":"#CACACA"}).style("fill-opacity",function(a){return"NP"!=a.properties.FIPS,.5});var t=[{name:"name",lat:26.206553,lon:88.332449},{name:"name",lat:26.534609,lon:85.156853},{name:"name",lat:27.919787,lon:84.071691},{name:"name",lat:28.932639,lon:84.391248},{name:"name",lat:28.324918,lon:86.328561},{name:"name",lat:27.949196,lon:88.405681}],u=(d.addMask({"class":"mapmask",outline:!1,path:t,frame:[1,2,3]}),[{name:"INDIA",lat:26.520475,lon:85.438853},{name:"CHINA",lat:28.35466,lon:86.213899}]),v=(d.addTextLabels({source:u,"class":"countryNames",fontSize:"14px",fontWeight:"normal",fontFamily:"arial",fontColor:"#9e9e9e",fontStyle:"normal",textAnchor:"middle",xOffset:8,yOffset:4,opacity:1,fade:0,delay:0,frame:[1,2,3]}),d.addVectorPolygon({source:a.adm1,"class":"adm1",fillOpacity:1,fill:"#FFF",strokeOpacity:1,strokeWidth:2,strokeColor:"#969696",frame:[1,2,3]}),[{name:"FAR-WESTERN",lat:29.376879,lon:80.898887},{name:"MID-WESTERN",lat:28.916311,lon:82.382042},{name:"WESTERN",lat:28.31081,lon:84.252552},{name:"CENTRAL",lat:27.519755,lon:85.342296},{name:"EASTERN",lat:27.151512,lon:87.31985}]),w=(d.addTextLabels({source:v,"class":"regionNames",fontSize:"13px",fontWeight:"normal",fontFamily:"arial",fontColor:"#9e9e9e",fontStyle:"normal",textAnchor:"middle",xOffset:8,yOffset:4,opacity:1,fade:0,delay:0,frame:[1,2,3]}),d.addVectorPolygon({source:a.adm3,"class":"adm3",fill:"transparent",strokeOpacity:1,strokeWidth:1,strokeColor:"#BFBFBF",frame:[1,2,3]}),d3.max(l,function(a){return a.values.total}));d3.select("#mapMax").text(addCommas(1e3*Math.ceil(w/1e3))).style("text-anchor","middle");var x=d3.scale.linear().domain([0,w]).range([colorbrewer.Blues[6][1],"#00508F"]),y=d.addVectorPolygon({source:a.adm3,"class":"district selected",fillOpacity:.7,fill:"#FFF",strokeOpacity:.15,strokeWidth:.5,strokeColor:"#000",frame:[1]});y.style("fill",function(a){var b=a.properties.pcode,c=a.properties.name,d=0;return $.each(l,function(a,e){e.key==b&&(d=e.values.total,e.name=c)}),d>0?x(d):"#FFF"}),d.addCustomLabels(l);var z=d.addVectorPolygon({source:a.adm3,"class":"districtMouse selected",fillOpacity:0,fill:"darkblue",strokeOpacity:0,strokeWidth:.5,strokeColor:"#000",frame:[1,2,3]});z.on("mouseover",function(a){var b=(d3.select(this).style("fill-opacity",.01).style("stroke-opacity",.5),a.properties.pcode),c=a.properties.name,d=[0,0];$.each(l,function(a,c){c.key==b&&(d=c.values.bars)}),d3.select("#dM").transition().duration(200).style("opacity",1),d3.selectAll(".mTitle").text(c),d3.selectAll(".mSubTitle1").text("PLASTIC SHEETS"),d3.selectAll(".mSubTitle2").text("SOLAR LAMPS"),d3.selectAll(".mFigure1").text(addCommas(d[0])),d3.selectAll(".mFigure2").text(addCommas(d[1])),d3.selectAll(".mBox1").style("fill","#2971B7"),d3.selectAll(".mBox2").style("fill",color[1])}).on("mouseout",function(){d3.select(this).style("fill-opacity",0).style("stroke-opacity",0),d3.select("#dM").transition().duration(200).style("opacity",0).each("end",function(a){d3.select(this).attr("transform","translate(-100,-100)")})}).on("mousemove",function(){coordinates=d3.mouse(this);var a=coordinates[0],b=coordinates[1];d3.select("#dM").attr("transform","translate("+(a+10)+","+(b+5)+")")});var A=d3.max(n,function(a){return"undefined"!==a.key?a.values.total:void 0}),B=d3.scale.linear().domain([0,A]).range([colorbrewer.Blues[6][1],"#00508F"]),C=d.addVectorPolygon({source:a.adm4,"class":"vdc selected",fillOpacity:.7,fill:"#FFF",strokeOpacity:.15,strokeWidth:.5,strokeColor:"#000",frame:[2]});C.style("fill",function(a){var b=a.properties.vdc_pcode,c=a.properties.name,d=0;return $.each(n,function(a,e){e.key==b&&(d=e.values.total,e.name=c)}),d>0?B(d):"#FFF"}),C.on("mouseover",function(a){var b=(d3.select(this).style("fill-opacity",.75).style("stroke-opacity",.4),a.properties.vdc_pcode),c=a.properties.name,d=[0,0];$.each(n,function(a,c){c.key==b&&(d=c.values.bars)}),d3.select("#dM").transition().duration(200).style("opacity",1),d3.selectAll(".mTitle").text(c),d3.selectAll(".mSubTitle1").text("PLASTIC SHEETS"),d3.selectAll(".mSubTitle2").text("SOLAR LAMPS"),d3.selectAll(".mFigure1").text(addCommas(d[0])),d3.selectAll(".mFigure2").text(addCommas(d[1])),d3.selectAll(".mBox1").style("fill","#2971B7"),d3.selectAll(".mBox2").style("fill",color[1])}).on("mouseout",function(){d3.select(this).style("fill-opacity",.7).style("stroke-opacity",.15),d3.select("#dM").transition().duration(200).style("opacity",0).each("end",function(a){d3.select(this).attr("transform","translate(-100,-100)")})}).on("mousemove",function(){coordinates=d3.mouse(this);var a=coordinates[0],b=coordinates[1];d3.select("#dM").attr("transform","translate("+(a+10)+","+(b+5)+")")});var D=d.addVectorPolygon({source:a.adm3,"class":"destroyed",fillOpacity:.75,fill:"#FFF",strokeOpacity:.15,strokeWidth:.5,strokeColor:"#000",frame:[3]}),E=(d3.sum(a.deaths,function(a){return parseFloat(a.GovtBuild_Damage.replace(/,/g,""))+parseFloat(a.PublicBuild_Damage.replace(/,/g,""))}),d3.scale.threshold().domain([1,1e4,2e4,3e4,4e4,5e4,1e6]).range(["0","1 - 9,999","10,000 - 19,999","20,000 - 29,999","30,000 - 39,999","40,000 - 49,999","50,000+"])),F=d3.scale.threshold().domain([1,1e4,2e4,3e4,4e4,5e4,1e7]).range(["#FFF","#FFF3E2","#FFD69D","#FFC16A","#FFAE3C","#FF9B0D","#E48A09"]),G=320,H=480,I=c.append("g").attr("class","legendDestroyed frame frame3").attr("transform","translate("+G+","+H+")");I.append("text").attr("x",0).attr("y",-10).style("font-family","'Open Sans', sans-serif").style("font-weight","bold").style("font-size","12px").text("Buildings damaged");var J=15,K=25,L=I.selectAll(".legendDestroyedRow").data(F.range()).enter().append("g").attr("transform",function(a,b){return"translate(0,"+(J+3)*b+")"});L.append("rect").style("stroke","#C6C6C6").style("stroke-width",.5).attr("width",K).attr("height",J).attr("x",0).attr("y",0).style("fill",function(a,b){return F.range()[b]}),L.append("text").attr("x",30).attr("y",12).style("font-size","11px").style("fill","#000").text(function(a,b){return E.range()[b]}),D.style("fill",function(b){var c=0,d=0;return $(a.deaths).each(function(){this.OCHA_PCODE==b.properties.pcode&&(c=parseFloat(this.GovtBuild_Damage.replace(/,/g,"")),d=parseFloat(this.PublicBuild_Damage.replace(/,/g,"")))}),F(c+d)}),D.on("mouseover",function(b){var c,d=(d3.select(this).style("fill-opacity",.8).style("stroke-opacity",.6),"No Data"),e=0,f=0;$(a.deaths).each(function(){this.OCHA_PCODE==b.properties.pcode&&(d=this.severity_class,c=b.properties.name,e=this.GovtBuild_Damage>0?parseFloat(this.GovtBuild_Damage.replace(/,/g,"")):0,f=this.PublicBuild_Damage>0?parseFloat(this.PublicBuild_Damage.replace(/,/g,"")):0)}),d3.select("#dM").style("opacity",1),d3.selectAll(".mTitle").text(c),d3.selectAll(".mSubTitle1").text("PUBLIC BUILDINGS"),d3.selectAll(".mSubTitle2").text("GOV. BUILDINGS"),d3.selectAll(".mFigure1").text(addCommas(f)),d3.selectAll(".mFigure2").text(addCommas(e)),d3.selectAll(".mBox1").style("fill",F(f)),d3.selectAll(".mBox2").style("fill",F(e))}).on("mouseout",function(){d3.select(this).style("fill-opacity",.75).style("stroke-opacity",.15),d3.select("#dM").style("opacity",0).attr("transform","translate(-100,-100)")}).on("mousemove",function(){coordinates=d3.mouse(this);var a=coordinates[0],b=coordinates[1];d3.select("#dM").attr("transform","translate("+(a+10)+","+(b+5)+")")});var M=d3.time.format("%d %b %Y"),N=d3.time.format("%Y-%m-%d"),O=new Date;d3.select("#printDate tspan").text("As of "+M(O)),document.title="UNHCR Nepal - Distributions - "+N(O);var P=120,Q=d3.max(k,function(a){return a.values.total});Q=1e3*Math.ceil(Q/1e3);var R=d3.scale.linear().range([0,P]).domain([0,Q]),S=700,T=d3.time.scale().range([0,S]);T.domain(d3.extent(k,function(a){return j(a.key)})).nice();var U=T.domain()[0],U=new Date(2015,3,25);T.domain(d3.extent(k,function(a){return j(a.key)})).nice(d3.time.month);var V=T.domain()[1];T.domain([U,V]);var W=Math.abs(Math.floor((T.domain()[0]-T.domain()[1])/864e5)),X=S/W-5,Y=c.append("g").attr("class","dateChartContainer").attr("transform","translate(330,660)");Y.append("line").attr("x1",-3).attr("y1",0).attr("x2",S+3).attr("y2",0).attr("stroke-width",.5).attr("stroke","#E5E5E5"),Y.append("line").attr("x1",-3).attr("y1",R(Q/2)).attr("x2",S+3).attr("y2",R(Q/2)).attr("stroke-width",.5).attr("stroke","#E5E5E5");var Z=Y.selectAll(".col").data(k).enter().append("g").attr("class","col").attr("transform",function(a,b){var c=T(j(a.key));return"translate("+c+",0)"}).on("mouseover",function(a){
d3.select(this).style("fill-opacity",.9),d3.select(this).select(".buttonMask").style("fill-opacity",.05);var b=d3.time.format("%a %d %b %Y"),c=b(j(a.key)),d=a.values.bars;d3.select("#dM").transition().duration(200).style("opacity",1),d3.selectAll(".mTitle").text(c),d3.selectAll(".mSubTitle1").text("PLASTIC SHEETS"),d3.selectAll(".mSubTitle2").text("SOLAR LAMPS"),d3.selectAll(".mFigure1").text(addCommas(d[0])),d3.selectAll(".mFigure2").text(addCommas(d[1])),d3.selectAll(".mBox1").style("fill","#2971B7"),d3.selectAll(".mBox2").style("fill",color[1])}).on("mouseout",function(){d3.select(this).style("fill-opacity",1),d3.select(this).select(".buttonMask").style("fill-opacity",0),d3.select("#dM").transition().duration(200).style("opacity",0).each("end",function(a){d3.select(this).attr("transform","translate(-100,-100)")})}).on("mousemove",function(){var a=d3.transform(d3.select(this).attr("transform")),b=a.translate[0];a.translate[1];coordinates=d3.mouse(this);var c=coordinates[0]+b+330,d=670;d3.select("#dM").attr("transform","translate("+(c+10)+","+(d+5)+")")});Z.append("rect").attr("fill","grey").style("fill-opacity",0).attr("class","buttonMask").attr("x",-2.5).attr("y",0).attr("width",X+5).attr("height",R(Q));var _=(Z.selectAll(".bar").data(function(a,b){return a.values.bars}).enter().append("rect").attr("class","bar").attr("width",X).attr("y",0).attr("x",0).attr("height",function(a,b){return R(a)}).attr("y",function(a,b){var c;return c=b>0?d3.select(this.parentNode).datum().values.bars[b-1]+a:a,P-R(c)}).attr("x",0).attr("height",function(a,b){return R(a)}).style("stroke","#FFF").style("stroke-opacity",.5).attr("fill",function(a,b,c){return color[b]}),d3.svg.axis().scale(T).orient("bottom").tickSize(0).ticks(3).tickPadding(9).tickFormat(d3.time.format("%d %b")));Y.append("g").attr("class","xAxis axis").attr("transform","translate("+X/2+",120)").call(_);var aa=_.tickSize(5,0).tickFormat("").tickPadding(0).orient("bottom");Y.append("g").classed("x",!0).classed("xgrid",!0).attr("transform","translate("+X/2+",120)").call(aa),Y.append("line").attr("x1",-10).attr("y1",120).attr("x2",S+10).attr("y2",120).attr("stroke-width",1).attr("stroke","#AEAEAE"),Y.append("line").attr("x1",-4).attr("y1",0).attr("x2",-4).attr("y2",120).attr("stroke-width",1).attr("stroke","#AEAEAE"),Y.append("line").attr("x1",-4).attr("y1",0).attr("x2",-10).attr("y2",0).attr("stroke-width",1).attr("stroke","#AEAEAE"),Y.append("text").attr("y",3).attr("x",-13).attr("id","dateChartMax").style("text-anchor","end").style("font-size",9).text(1e3),Y.append("line").attr("x1",-4).attr("y1",R(Q/2)).attr("x2",-10).attr("y2",R(Q/2)).attr("stroke-width",1).attr("stroke","#AEAEAE"),Y.append("text").attr("y",function(){return R(Q/2)+3}).attr("x",-13).attr("id","dateChartMid").style("text-anchor","end").style("font-size",9).text(addCommas(Q/2)),Y.append("text").attr("y",R(Q)+3).attr("x",-13).style("text-anchor","end").style("font-size",9).text(0),d3.select("#dateChartMax").text(addCommas(Q));var ba=(viz.tableBar({source:l,appendTo:c,id:"topDistricts","class":"topDistricts",width:200,height:410,xOffset:105,yOffset:385,limit:20,title:"",valueField:"Deaths",nameField:"name",fillOpacity:1,fill:"#cb181d",frame:[1,2,3]}),c.append("g").attr("id","dM").attr("transform","translate(-100,-100)").style("opacity",0));ba.append("rect").attr("width",110).attr("height",95).style("fill","#FFF").style("fill-opacity",.9),ba.append("text").attr("x",5).attr("y",15).attr("class","mTitle").text("District"),ba.append("text").attr("x",5).attr("y",31).attr("class","mSubTitle1").text("POPULATION"),ba.append("rect").attr("class","mBox1").attr("x",5).attr("y",37).attr("height",10).attr("width",3).style("fill","blue"),ba.append("text").attr("x",12).attr("y",46).attr("class","mFigure1").text("n/a"),ba.append("text").attr("x",5).attr("y",65).attr("class","mSubTitle2").text("HOUSEHOLDS"),ba.append("rect").attr("class","mBox2").attr("x",5).attr("y",72).attr("height",10).attr("width",3).style("fill","blue"),ba.append("text").attr("x",12).attr("y",81).attr("class","mFigure2").text("n/a");var ca=[{name:"UNHCR Kathmandu",lat:27.70169,lon:85.3206}],da=(d.addSymbolPoints({source:ca,icon:"./images/mapicons/Office2.svg","class":"office2",width:14,height:14,xOffset:-2,yOffset:0,fontSize:11,fontWeight:"bold",fontColor:"#000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,frame:[1,2,3],fade:2e3,delay:0,orientation:"left"}),[{name:"UNHCR Damak",lat:26.63,lon:87.7}]);d.addSymbolPoints({source:da,icon:"./images/mapicons/Office3.svg","class":"office2",width:14,height:14,xOffset:1,yOffset:0,fontSize:11,fontWeight:"bold",fontColor:"#000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,frame:[1,2,3],fade:2e3,delay:0,orientation:"right"});d3.select("#interactiveLink").append("a").attr("href","http://data.unhcr.org/nepal/shelter").append("text").style("font-family","'Open Sans', sans-serif").style("font-weight","bold").style("font-size",14).attr("fill",color[0]).attr("x",1172).attr("y",53).text("http://data.unhcr.org/nepal/shelter");var ea=0;$("g#zoomIn #icon").css("fill-opacity",1),$("g#zoomOut #icon").css("fill-opacity",.2),$("g#zoomIn").css("cursor","pointer"),$("g#zoomOut").css("cursor","pointer"),$("g#zoomIn").on("click",function(){ea++,$("g#zoomOut #icon").css("fill-opacity",1),$(".zoomIn").trigger("click"),2==ea&&$("g#zoomIn #icon").css("fill-opacity",.2)}),$("g#zoomOut").on("click",function(){ea-=1,$("g#zoomIn #icon").css("fill-opacity",1),$(".zoomOut").trigger("click"),0==ea&&$("g#zoomOut #icon").css("fill-opacity",.2)}),$("#framePrev, #leftButton").click(function(){var a=viz.prevFrame(1e3);$("#lContent").scrollTop(0),b(a),$("#activeFrame").text(a)}),$("#frameNext, #rightButton").click(function(){var a=viz.nextFrame(1e3);$("#lContent").scrollTop(0),b(a),$("#activeFrame").text(a)}),$(".selectFrame").on("click",function(){var a=$(this).attr("id"),b=$(this).text();viz.gotoFrame(a,1e3),$("#selectFrame .textlabel").text(b),$("#activeFrame").text(a)}),viz.maxFrames(5),viz.gotoFrame(1,1);var fa=1;d3.select("#MapTitle").style("text-anchor","middle"),d3.select("#MapTitle tspan").attr("x",0),d3.select("#buttonLeft").style("opacity",.2).attr("class","disabled").on("click",function(){d3.select("#buttonRight").style("opacity",1).attr("class",""),d3.select("#buttonLeft").style("opacity",1).attr("class",""),fa>1&&(viz.prevFrame(1e3),d3.select("#MapTitle tspan").text("ITEMS DISTRIBUTED BY DISTRICT").style("font-size","17px"),fa-=1),1==fa&&(d3.select("#buttonLeft").style("opacity",1).attr("class","disabled"),d3.select("#buttonLeft").style("opacity",.2),d3.select("#buttonRight").style("opacity",1).attr("class",""),d3.select("#mapMax").text(addCommas(1e3*Math.ceil(w/1e3))).style("text-anchor","middle")),2==fa&&d3.select("#MapTitle tspan").text("ITEMS DISTRIBUTED BY VDC").style("font-size","17px")}),d3.select("#buttonRight").on("click",function(){d3.select("#buttonRight").style("opacity",1).attr("class",""),d3.select("#buttonLeft").style("opacity",1).attr("class",""),3>=fa&&(viz.nextFrame(1e3),fa++),2==fa&&d3.select("#MapTitle tspan").text("ITEMS DISTRIBUTED BY VDC").style("font-size","17px"),3==fa&&(d3.select("#buttonRight").style("opacity",.2).attr("class","disabled"),d3.select("#buttonLeft").style("opacity",1).attr("class",""),d3.select("#MapTitle tspan").text("BUILDINGS DAMAGED BY DISTRICT").style("font-size","16px")),d3.select("#mapMax").text(addCommas(100*Math.ceil(A/100))).style("text-anchor","middle")}),d3.select("#buttonLeft").on("mouseover",function(){"disabled"==$("#buttonLeft").attr("class")?d3.select(this).style("opacity",.2):d3.select(this).style("opacity",.7)}).on("mouseout",function(){"disabled"==$("#buttonLeft").attr("class")?d3.select(this).style("opacity",.2):d3.select(this).style("opacity",1)}),d3.select("#buttonRight").on("mouseover",function(){"disabled"==$("#buttonRight").attr("class")?d3.select(this).style("opacity",.2):d3.select(this).style("opacity",.7)}).on("mouseout",function(){"disabled"==$("#buttonRight").attr("class")?d3.select(this).style("opacity",.4):d3.select(this).style("opacity",1)}),$("#donate").on("click",function(){window.open("http://donate.unhcr.org/international/nepal","_blank")}),d3.select("#donate").on("mouseover",function(){d3.select(this).selectAll("#bg").attr("fill","#00669E")}).on("mouseout",function(){d3.select(this).selectAll("#bg").attr("fill","#2971B7")}),$(document).ready(function(){$("#loader").hide()})});